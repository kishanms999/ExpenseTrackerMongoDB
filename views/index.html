<html>
    <head>
        <title>Expense Tracker App</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
        <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>
    </head>
    <body>
        <form onsubmit="expenseDetails(event)" >
            <label>Choose Expense Amount</label>
            <input type="number" name="xpamnt" id="xpamnt" required>
            <label>Choose Description</label>
            <input type="text" name="descr" id="descr" required>
            <label>Choose a category</label>
            <select name="cat" id="cat">
                <option value="fuel">fuel</option>
                <option value="food">food</option>
                <option value="electricity">electricity</option>
                <option value="movie">Movie</option>
            </select>
            <button>Add Expense</button>
        </form>
        <ul id="ListOfExpenses"></ul>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.3.4/axios.js"></script>
        <script>
            
            function expenseDetails(event){
                event.preventDefault();
                const expense=event.target.xpamnt.value;
                const description=event.target.descr.value;
                const category=event.target.cat.value;

                let obj={
                    expense,
                    description,
                    category
                }
                axios.post("http://localhost:3000/add-expense",obj).then((response)=>{
                    showOnScreen(response.data.newExpenseDetail)
                    console.log(response)
                })
                .catch((err)=>{
                    document.body.innerHTML=document.body.innerHTML+"<h4>Something went wrong</h4>"
                    console.log(err)
                })
            }
            
            window.addEventListener("DOMContentLoaded", () => {
                    axios.get('http://localhost:3000/get-expenses').then((response)=>{
                        console.log(response)
                        for(var i=0;i<response.data.allExpenses.length;i++){
                                showOnScreen(response.data.allExpenses[i])
                            }
                        }).catch((error)=>{
                            console.log(error)
                        })
                        
                })          
            
                function showOnScreen(expense){
                document.getElementById('xpamnt').value='';
                document.getElementById('descr').value='';
                document.getElementById('cat').value='';
                // if(localStorage.getItem(user.email)!=null){
                //     removeUserFromScreen(user.email)
                // }
                
                const parentNode=document.getElementById('ListOfExpenses');
                const childHTML=`<li id=${expense.id}>${expense.amount}-${expense.description}-${expense.category}
                    <button onclick=deleteExpense('${expense.id}')>Delete Expense</button>
                    <button onclick=editExpense('${expense.amount}','${expense.description}','${expense.category}','${expense.id}')>Edit Expense</button>
                    </li>`
                parentNode.innerHTML=parentNode.innerHTML+childHTML    
            }

            function deleteExpense(expenseId){
                axios.delete(`http://localhost:3000/delete-expense/${expenseId}`)
                    .then((response)=> {
                        // console.log(response);
                        removeFromScreen(expenseId)
                    })
                    .catch((err)=>{
                        console.log(err)
                    })
            }

            function removeFromScreen(expenseId){
                const parentNode=document.getElementById('ListOfExpenses');
                const childNodeToBeDeleted=document.getElementById(expenseId);
                // console.log(childNodeToBeDeleted);
                if(childNodeToBeDeleted){
                    parentNode.removeChild(childNodeToBeDeleted);
                }
            }

            function editExpense(amount,description,category,expenseId){
                document.getElementById('xpamnt').value=amount;
                document.getElementById('descr').value=description;
                document.getElementById('cat').value=category;
                deleteExpense(expenseId)
            }
        
            
        
        </script>
    </body>
</html>